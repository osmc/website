<section class="post-comments">
  <header>
    <h3>Comments</h3>
  </header>

  <div id="discourse-comments"></div>
  <script type="text/javascript">
    function isVisible(elem, offset) {
      var $elem = $(elem);
      var $window = $(window);
      var docViewTop = $window.scrollTop();
      var docViewBottom = docViewTop + $window.height();
      var elemTop = $elem.offset().top;
      var elemBottom = elemTop + $elem.height() - offset;
      return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));
    }
    var commentsLoaded = false;

    function comments(visible) {
      if (visible && !commentsLoaded) {
        commentsLoaded = true;
        DiscourseEmbed = {
          discourseUrl: "https://discourse.osmc.tv/",
          topicId: 8431
        };
        (function () {
          var d = document.createElement("script");
          d.type = "text/javascript";
          d.async = true;
          d.src = DiscourseEmbed.discourseUrl + "javascripts/embed.js";
          (document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(d);
        })();
      }
    };

    $(window).on("scroll", function () {
      if (!commentsLoaded) {
        var visible = isVisible(".post-comments", 300);
        comments(visible);
      }
    });

    var visible = isVisible(".post-comments", 300);
    comments(visible);
  </script>
</section>